{% extends "base.html" %}

{% block title %}Painel Administrativo - Sistema de Agendamentos{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="bi bi-gear"></i> Painel Administrativo
        </h1>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-tools"></i> Total de Equipamentos
                </h5>
                <p class="card-text display-4">{{ equipamentos|length }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-person"></i> Total de Usuários
                </h5>
                <p class="card-text display-4">{{ usuarios|length }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-calendar-check"></i> Reservas Ativas
                </h5>
                <p class="card-text display-4">{{ reservas_ativas }}</p>
                <small>Total: {{ total_reservas }}</small>
            </div>
        </div>
    </div>
</div>

<!-- Equipment Create Form -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">
                    <i class="bi bi-plus-circle"></i> Cadastrar Novo Equipamento
                </h4>
            </div>
            <div class="card-body">
                <form method="post" action="{{ url_for('criar_equipamento') }}">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="novoEquipamentoNome" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="novoEquipamentoNome" name="nome" required>
                        </div>
                        <div class="col-md-4">
                            <label for="novoEquipamentoLocalizacao" class="form-label">Localização</label>
                            <input type="text" class="form-control" id="novoEquipamentoLocalizacao" name="localizacao">
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="novoEquipamentoAtivo" name="ativo" checked>
                                <label class="form-check-label" for="novoEquipamentoAtivo">
                                    Equipamento ativo
                                </label>
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="novoEquipamentoDescricao" class="form-label">Descrição</label>
                            <textarea class="form-control" id="novoEquipamentoDescricao" name="descricao" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Salvar Equipamento
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Equipments Management -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="bi bi-tools"></i> Gerenciar Equipamentos
                </h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Descrição</th>
                                <th>Localização</th>
                                <th>Status</th>
                                <th>Criado em</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for equipamento in equipamentos %}
                            <tr>
                                <td>{{ equipamento.id }}</td>
                                <td><strong>{{ equipamento.nome }}</strong></td>
                                <td>{{ equipamento.descricao or '-' }}</td>
                                <td>{{ equipamento.localizacao or '-' }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if equipamento.ativo else 'danger' }}">
                                        {{ 'Ativo' if equipamento.ativo else 'Inativo' }}
                                    </span>
                                </td>
                                <td>{{ equipamento.created_at[:10] }}</td>
                                <td>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editarEquipamentoModal-{{ equipamento.id }}">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <form method="post" action="{{ url_for('alterar_status_equipamento', equipamento_id=equipamento.id) }}">
                                            <input type="hidden" name="ativo" value="{{ 0 if equipamento.ativo else 1 }}">
                                            <button type="submit" class="btn btn-sm btn-outline-{{ 'danger' if equipamento.ativo else 'success' }}">
                                                <i class="bi {{ 'bi-x-circle' if equipamento.ativo else 'bi-check-circle' }}"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% for equipamento in equipamentos %}
<div class="modal fade" id="editarEquipamentoModal-{{ equipamento.id }}" tabindex="-1" aria-labelledby="editarEquipamentoModalLabel-{{ equipamento.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarEquipamentoModalLabel-{{ equipamento.id }}">
                    Editar Equipamento #{{ equipamento.id }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{{ url_for('editar_equipamento', equipamento_id=equipamento.id) }}">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="equipamentoNome-{{ equipamento.id }}" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="equipamentoNome-{{ equipamento.id }}" name="nome" value="{{ equipamento.nome }}" required>
                        </div>
                        <div class="col-md-6">
                            <label for="equipamentoLocalizacao-{{ equipamento.id }}" class="form-label">Localização</label>
                            <input type="text" class="form-control" id="equipamentoLocalizacao-{{ equipamento.id }}" name="localizacao" value="{{ equipamento.localizacao }}">
                        </div>
                        <div class="col-12">
                            <label for="equipamentoDescricao-{{ equipamento.id }}" class="form-label">Descrição</label>
                            <textarea class="form-control" id="equipamentoDescricao-{{ equipamento.id }}" name="descricao" rows="3">{{ equipamento.descricao or '' }}</textarea>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="equipamentoAtivo-{{ equipamento.id }}" name="ativo" {% if equipamento.ativo %}checked{% endif %}>
                                <label class="form-check-label" for="equipamentoAtivo-{{ equipamento.id }}">
                                    Equipamento ativo
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Atualizar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Users Management -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="bi bi-person-plus"></i> Cadastrar Novo Usuário
                </h4>
            </div>
            <div class="card-body">
                <form method="post" action="{{ url_for('criar_usuario') }}">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="novoUsuarioNome" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="novoUsuarioNome" name="nome" required>
                        </div>
                        <div class="col-md-4">
                            <label for="novoUsuarioEmail" class="form-label">E-mail *</label>
                            <input type="email" class="form-control" id="novoUsuarioEmail" name="email" required>
                        </div>
                        <div class="col-md-4">
                            <label for="novoUsuarioTipo" class="form-label">Tipo</label>
                            <select class="form-select" id="novoUsuarioTipo" name="tipo">
                                <option value="usuario" selected>Usuário</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-person-check"></i> Salvar Usuário
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="bi bi-person"></i> Gerenciar Usuários
                </h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Tipo</th>
                                <th>Cadastrado em</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usuario in usuarios %}
                            <tr>
                                <td>{{ usuario.id }}</td>
                                <td><strong>{{ usuario.nome }}</strong></td>
                                <td>{{ usuario.email }}</td>
                                <td>
                                    <span class="badge bg-{{ 'warning' if usuario.tipo == 'admin' else 'secondary' }}">
                                        {{ usuario.tipo|title }}
                                    </span>
                                </td>
                                <td>{{ usuario.created_at[:10] }}</td>
                                <td>
                                    <button type="button" class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#editarUsuarioModal-{{ usuario.id }}">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% for usuario in usuarios %}
<div class="modal fade" id="editarUsuarioModal-{{ usuario.id }}" tabindex="-1" aria-labelledby="editarUsuarioModalLabel-{{ usuario.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editarUsuarioModalLabel-{{ usuario.id }}">
                    Editar Usuário #{{ usuario.id }}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{{ url_for('editar_usuario', usuario_id=usuario.id) }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="usuarioNome-{{ usuario.id }}" class="form-label">Nome *</label>
                        <input type="text" class="form-control" id="usuarioNome-{{ usuario.id }}" name="nome" value="{{ usuario.nome }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="usuarioEmail-{{ usuario.id }}" class="form-label">E-mail *</label>
                        <input type="email" class="form-control" id="usuarioEmail-{{ usuario.id }}" name="email" value="{{ usuario.email }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="usuarioTipo-{{ usuario.id }}" class="form-label">Tipo</label>
                        <select class="form-select" id="usuarioTipo-{{ usuario.id }}" name="tipo">
                            <option value="usuario" {% if usuario.tipo != 'admin' %}selected{% endif %}>Usuário</option>
                            <option value="admin" {% if usuario.tipo == 'admin' %}selected{% endif %}>Administrador</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save"></i> Atualizar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<!-- Quick Actions -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">
                    <i class="bi bi-lightning"></i> Ações Rápidas
                </h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('equipamentos') }}" class="btn btn-primary w-100">
                            <i class="bi bi-tools"></i> Ver Equipamentos
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('minhas_reservas') }}" class="btn btn-success w-100">
                            <i class="bi bi-list-check"></i> Ver Reservas
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('calendario') }}" class="btn btn-info w-100">
                            <i class="bi bi-calendar3"></i> Ver Calendário
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('reservar') }}" class="btn btn-warning w-100">
                            <i class="bi bi-plus-circle"></i> Nova Reserva
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
